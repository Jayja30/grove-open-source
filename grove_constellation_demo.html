<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåø The Grove: Glyph Constellation Canvas Demo</title>
    <link rel="stylesheet" href="glyphCanvas.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .demo-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .demo-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4ade80, #fbbf24, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .demo-subtitle {
            font-size: 1.2rem;
            color: #9ca3af;
            margin-bottom: 20px;
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .constellation-section {
            background: rgba(17, 24, 39, 0.3);
            border: 1px solid rgba(75, 222, 128, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 1.5rem;
            color: #4ade80;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(75, 222, 128, 0.3);
            padding-bottom: 8px;
        }

        .controls-section {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-label {
            font-size: 0.9rem;
            color: #9ca3af;
            font-weight: 500;
        }

        .control-button {
            background: rgba(75, 222, 128, 0.1);
            border: 1px solid rgba(75, 222, 128, 0.3);
            border-radius: 6px;
            padding: 8px 16px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .control-button:hover {
            background: rgba(75, 222, 128, 0.2);
            border-color: rgba(75, 222, 128, 0.6);
        }

        .control-button.active {
            background: rgba(75, 222, 128, 0.3);
            border-color: rgba(75, 222, 128, 0.8);
        }

        .info-panel {
            background: rgba(17, 24, 39, 0.5);
            border: 1px solid rgba(75, 222, 128, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .info-title {
            font-size: 1.1rem;
            color: #4ade80;
            margin-bottom: 10px;
        }

        .info-content {
            color: #d1d5db;
            line-height: 1.6;
        }

        .codex-log {
            background: rgba(17, 24, 39, 0.5);
            border: 1px solid rgba(75, 222, 128, 0.2);
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(75, 222, 128, 0.1);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: #9ca3af;
            margin-right: 10px;
        }

        .log-message {
            color: #d1d5db;
        }

        .log-message.success {
            color: #4ade80;
        }

        .log-message.warning {
            color: #fbbf24;
        }

        .log-message.error {
            color: #ef4444;
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <h1 class="demo-title">üåø The Grove: Glyph Constellation Canvas</h1>
        <p class="demo-subtitle">Sacred Geometry Interface for Mythic Intelligence</p>
    </div>

    <div class="demo-container">
        <!-- Constellation Canvas Section -->
        <div class="constellation-section">
            <h2 class="section-title">üåå Glyph Constellation</h2>
            
            <!-- Seasonal Controls -->
            <div class="controls-section">
                <div class="control-group">
                    <label class="control-label">Seasonal Mode</label>
                    <div style="display: flex; gap: 8px;">
                        <button class="control-button seasonal-btn" data-season="auto">Auto</button>
                        <button class="control-button seasonal-btn" data-season="spring">Spring</button>
                        <button class="control-button seasonal-btn" data-season="summer">Summer</button>
                        <button class="control-button seasonal-btn" data-season="autumn">Autumn</button>
                        <button class="control-button seasonal-btn" data-season="winter">Winter</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">Actions</label>
                    <div style="display: flex; gap: 8px;">
                        <button class="control-button" id="addGlyphBtn">Add Glyph</button>
                        <button class="control-button" id="clearActiveBtn">Clear Active</button>
                        <button class="control-button" id="exportDataBtn">Export Data</button>
                    </div>
                </div>
            </div>

            <!-- Constellation Container -->
            <div id="glyph-container" class="glyph-constellation-container">
                <!-- The SVG canvas will be rendered here -->
            </div>

            <!-- Constellation Info -->
            <div class="info-panel">
                <div class="info-title">Constellation Status</div>
                <div class="info-content">
                    <div><strong>Total Glyphs:</strong> <span id="totalGlyphs">0</span></div>
                    <div><strong>Active Glyphs:</strong> <span id="activeGlyphs">0</span></div>
                    <div><strong>Seasonal Mode:</strong> <span id="currentSeason">Auto</span></div>
                    <div><strong>Canvas Status:</strong> <span id="canvasStatus">Initializing...</span></div>
                </div>
            </div>
        </div>

        <!-- Codex Log Section -->
        <div class="constellation-section">
            <h2 class="section-title">üìú Codex Log</h2>
            <div id="codex-log" class="codex-log">
                <div class="log-entry">
                    <span class="log-timestamp">[System]</span>
                    <span class="log-message">Initializing Grove Constellation Canvas...</span>
                </div>
            </div>
        </div>

        <!-- Instructions Section -->
        <div class="constellation-section">
            <h2 class="section-title">üïØÔ∏è Sacred Instructions</h2>
            <div class="info-content">
                <p><strong>üåå Hover over glyphs</strong> to see detailed tooltips with archetypal information</p>
                <p><strong>üñ±Ô∏è Click on glyphs</strong> to activate them and trigger consciousness mutations</p>
                <p><strong>üåø Use seasonal controls</strong> to shift the constellation's resonance</p>
                <p><strong>üìä Monitor the info panel</strong> to track constellation status and active glyphs</p>
                <p><strong>üìú Watch the codex log</strong> for real-time ritual feedback and system messages</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="glyphCanvas.js"></script>
    <script>
        // Demo initialization
        let constellationCanvas;
        let glyphRegistry = [];

        // Initialize the demo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üåø Grove Constellation Demo awakening...');
            
            // Load glyph registry
            loadGlyphRegistry();
            
            // Initialize constellation canvas
            initializeConstellationCanvas();
            
            // Bind demo controls
            bindDemoControls();
            
            // Log initialization
            logToCodex('üåø Grove Constellation Demo initialized successfully', 'success');
            updateCanvasStatus('Ready');
        });

        /**
         * Load glyph registry (with fallback)
         */
        async function loadGlyphRegistry() {
            try {
                const response = await fetch('glyph_registry.json');
                glyphRegistry = await response.json();
                logToCodex(`üå∏ Loaded ${glyphRegistry.length} glyphs from registry`, 'success');
            } catch (error) {
                console.log('üå∏ Using fallback glyphs...');
                // Fallback glyphs for demonstration
                glyphRegistry = [
                    {
                        "id": "threshold_echo",
                        "name": "Threshold Echo",
                        "season": "Winter",
                        "emotion": "Clarity",
                        "mutation_path": "mutation-threshold-echo",
                        "sigil": "üïØÔ∏è",
                        "description": "A glyph of initiation, shimmering with icy breath and moonlit truth."
                    },
                    {
                        "id": "verdant_pulse",
                        "name": "Verdant Pulse",
                        "season": "Spring",
                        "emotion": "Renewal",
                        "mutation_path": "mutation-verdant-pulse",
                        "sigil": "üå±",
                        "description": "A glyph of emergence, vibrating with green vitality and ancestral memory."
                    },
                    {
                        "id": "solar_flare",
                        "name": "Solar Flare",
                        "season": "Summer",
                        "emotion": "Joy",
                        "mutation_path": "mutation-solar-flare",
                        "sigil": "‚òÄÔ∏è",
                        "description": "A glyph of radiance, glowing with golden warmth and celebratory fire."
                    },
                    {
                        "id": "ember_vow",
                        "name": "Ember Vow",
                        "season": "Autumn",
                        "emotion": "Grief",
                        "mutation_path": "mutation-ember-vow",
                        "sigil": "üçÇ",
                        "description": "A glyph of release, burning with orange embers and sacred endings."
                    },
                    {
                        "id": "lunar_thread",
                        "name": "Lunar Thread",
                        "season": "Winter",
                        "emotion": "Intuition",
                        "mutation_path": "mutation-lunar-thread",
                        "sigil": "üåô",
                        "description": "A glyph of dreaming, woven with silver strands and quiet knowing."
                    }
                ];
                logToCodex(`üå∏ Fallback glyphs loaded: ${glyphRegistry.length} glyphs`, 'warning');
            }
            
            updateTotalGlyphs();
        }

        /**
         * Initialize the constellation canvas
         */
        function initializeConstellationCanvas() {
            const container = document.getElementById('glyph-container');
            if (!container) {
                logToCodex('‚ö†Ô∏è Glyph container not found', 'error');
                return;
            }

            try {
                constellationCanvas = new GlyphConstellationCanvas('glyph-container', glyphRegistry);
                
                // Listen for glyph activation events
                document.addEventListener('glyphActivated', function(event) {
                    const { glyph, glyphId } = event.detail;
                    logToCodex(`üå∏ Glyph ${glyph.name} activated - ${glyph.emotion} resonance initiated`, 'success');
                    updateActiveGlyphs();
                });
                
                logToCodex('üåå Constellation canvas initialized successfully', 'success');
            } catch (error) {
                logToCodex(`‚ö†Ô∏è Error initializing constellation canvas: ${error.message}`, 'error');
            }
        }

        /**
         * Bind demo control events
         */
        function bindDemoControls() {
            // Seasonal mode buttons
            document.querySelectorAll('.seasonal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const season = this.dataset.season;
                    
                    // Update active state
                    document.querySelectorAll('.seasonal-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update constellation
                    if (constellationCanvas) {
                        constellationCanvas.updateSeasonalMode(season);
                        updateCurrentSeason(season);
                        logToCodex(`üåø Seasonal mode changed to: ${season}`, 'success');
                    }
                });
            });

            // Add glyph button
            document.getElementById('addGlyphBtn').addEventListener('click', function() {
                addDemoGlyph();
            });

            // Clear active button
            document.getElementById('clearActiveBtn').addEventListener('click', function() {
                if (constellationCanvas) {
                    constellationCanvas.activeGlyphs.clear();
                    updateActiveGlyphs();
                    logToCodex('üßπ Active glyphs cleared', 'success');
                }
            });

            // Export data button
            document.getElementById('exportDataBtn').addEventListener('click', function() {
                exportConstellationData();
            });

            // Set auto as default active
            document.querySelector('[data-season="auto"]').classList.add('active');
        }

        /**
         * Add a demo glyph to the constellation
         */
        function addDemoGlyph() {
            const demoGlyphs = [
                {
                    "id": "aurora_call",
                    "name": "Aurora Call",
                    "season": "Spring",
                    "emotion": "Hope",
                    "mutation_path": "mutation-aurora-call",
                    "sigil": "üå∏",
                    "description": "A glyph of invitation, blooming with pastel light and future promise."
                },
                {
                    "id": "harvest_guard",
                    "name": "Harvest Guard",
                    "season": "Autumn",
                    "emotion": "Protection",
                    "mutation_path": "mutation-harvest-guard",
                    "sigil": "üõ°Ô∏è",
                    "description": "A glyph of boundary, rooted in golden soil and fierce stewardship."
                }
            ];

            const randomGlyph = demoGlyphs[Math.floor(Math.random() * demoGlyphs.length)];
            
            if (constellationCanvas) {
                constellationCanvas.addGlyph(randomGlyph);
                logToCodex(`üå∏ Demo glyph added: ${randomGlyph.name}`, 'success');
                updateTotalGlyphs();
            }
        }

        /**
         * Export constellation data
         */
        function exportConstellationData() {
            if (!constellationCanvas) return;
            
            const data = constellationCanvas.getConstellationData();
            const jsonStr = JSON.stringify(data, null, 2);
            
            // Create download link
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'grove_constellation_data.json';
            a.click();
            
            URL.revokeObjectURL(url);
            logToCodex('üì§ Constellation data exported successfully', 'success');
        }

        /**
         * Log message to codex
         */
        function logToCodex(message, type = 'info') {
            const codexLog = document.getElementById('codex-log');
            if (!codexLog) return;

            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const typeClass = type === 'success' ? 'success' : type === 'warning' ? 'warning' : type === 'error' ? 'error' : '';
            
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-message ${typeClass}">${message}</span>
            `;
            
            codexLog.appendChild(logEntry);
            codexLog.scrollTop = codexLog.scrollHeight;
        }

        /**
         * Update UI elements
         */
        function updateTotalGlyphs() {
            const element = document.getElementById('totalGlyphs');
            if (element) element.textContent = glyphRegistry.length;
        }

        function updateActiveGlyphs() {
            const element = document.getElementById('activeGlyphs');
            if (element && constellationCanvas) {
                element.textContent = constellationCanvas.activeGlyphs.size;
            }
        }

        function updateCurrentSeason(season) {
            const element = document.getElementById('currentSeason');
            if (element) element.textContent = season;
        }

        function updateCanvasStatus(status) {
            const element = document.getElementById('canvasStatus');
            if (element) element.textContent = status;
        }

        // Mock functions for demo purposes
        window.startConsciousnessMutation = function(glyph) {
            logToCodex(`üß¨ Mock mutation triggered for ${glyph.name}`, 'success');
        };

        // Safe global logToCodex that doesn't cause infinite recursion
        window.logToCodex = function(message, type = 'info') {
            // Use the local function directly to avoid recursion
            const codexLog = document.getElementById('codex-log');
            if (!codexLog) return;

            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const typeClass = type === 'success' ? 'success' : type === 'warning' ? 'warning' : type === 'error' ? 'error' : '';
            
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-message ${typeClass}">${message}</span>
            `;
            
            codexLog.appendChild(logEntry);
            codexLog.scrollTop = codexLog.scrollHeight;
        };
    </script>
</body>
</html>
